# Automated Daily Blog — Implementation Plan

> **Status**: Approved with feedback — ready for implementation  
> **Last updated**: 2026-02-19  
> **Repos involved**: Website Frontend (all changes), Engine (read-only source)

---

## Overview

A GitHub Actions workflow runs once per day, gathers the last 24 hours of
**Engine repo** activity (commits, merged PRs, opened/closed issues), sends it
to an AI model to write a blog post **and generate a hero image**, then opens a
**pull request** on the Website Frontend repo for human review before merging.

Posts are clearly labeled as AI-generated. Human-written posts coexist in the
same content directory.

---

## Design Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Content format | Markdown files in `content/blog/` | No CMS, version-controlled, easy to edit before merge |
| Delivery method | **PR for review** (never auto-push) | Owner reviews / edits AI output before it goes live |
| Repos covered | Engine only | Backend is private; Interface can be added later |
| Social posting | Bluesky + LinkedIn (both opt-in, off by default) | No X/Twitter; toggleable via env vars |
| Hero images | Pollinations.ai (`gen.pollinations.ai`) with API key + Phoenix logo fallback | Current Pollinations `gen` API requires key auth; workflow validates key and falls back safely when unavailable |
| Skip logic | No post if zero activity | Avoids empty "nothing happened" spam |

---

## Part A — Blog Content Infrastructure (Website Frontend)

### A1. Content directory

```
content/
  blog/
    2026-02-19-engine-daily-update.md   ← AI-generated
    2026-02-20-why-we-forked-godot.md   ← human-written
```

Each `.md` file has YAML front matter:

```yaml
---
title: "Engine Daily Update — Feb 19, 2026"
date: "2026-02-19"
slug: "2026-02-19-engine-daily-update"
author: "Phoenix AI"
aiGenerated: true
tags: ["engine", "daily-update"]
heroImage: "/images/blog/2026-02-19-engine-daily-update.png"
summary: "One-sentence preview for the blog index card."
---
```

Human posts use `aiGenerated: false` (or omit the field) and have no AI badge.

### A2. Dependencies to add

| Package | Purpose |
|---------|---------|
| `gray-matter` | Parse YAML front matter from `.md` files |
| `remark` + `remark-html` | Convert Markdown body → HTML for rendering |

No MDX, no heavy CMS. Keep it minimal.

### A3. Blog data layer — `src/lib/blog.ts`

Exports:

- `getAllPosts(): PostMeta[]` — reads `content/blog/*.md`, parses front matter,
  sorts by date descending.
- `getPostBySlug(slug: string): Post` — returns full parsed post (meta + HTML
  body).
- `getAllSlugs(): string[]` — for `generateStaticParams()`.

### A4. Blog routes

| Route | File | Behavior |
|-------|------|----------|
| `/blog` | `src/app/blog/page.tsx` | Index page — card grid from `getAllPosts()`. AI posts show an **"AI-Generated"** badge. |
| `/blog/[slug]` | `src/app/blog/[slug]/page.tsx` | Detail page — full rendered markdown. AI posts show a **disclaimer banner** at top. Phoenix logo + hero image displayed. |

#### AI-Generated disclaimer (shown on detail page)

> *"This post was automatically generated by AI from engine activity data.
> It has been reviewed but may contain inaccuracies. For authoritative
> information, see the linked PRs and commits."*

### A5. Styling

Re-use existing `.card`, `.hero`, `.label` CSS classes. Add:

- `.badge-ai` — small orange/muted pill badge ("AI-Generated")
- `.badge-human` — optional subtle badge for human posts
- `.blog-hero-image` — hero image container with aspect ratio
- `.blog-disclaimer` — styled callout box for the AI disclaimer

### A6. Images

- **Phoenix logo**: already at `public/images/phoenix-icon.png` — used as a
  fallback and as an overlay/watermark on hero images.
- **AI-generated hero images**: stored at
  `public/images/blog/<slug>.png`. Generated by Pollinations during the
  workflow run based on a prompt derived from the post content.
- If image generation fails, the post still publishes with the Phoenix logo as
  the hero.

---

## Part B — GitHub Actions Workflow (Website Frontend)

### B1. Workflow file

`.github/workflows/daily-blog.yml`

### B2. Trigger

```yaml
on:
  schedule:
    - cron: '0 6 * * *'   # 6 AM UTC daily
  workflow_dispatch:        # manual trigger for testing
```

### B3. Feature toggles (environment variables / repo variables)

All toggles are configured as **GitHub repo variables** (Settings → Variables →
Actions) so they can be flipped in the UI without touching code:

For copy/paste values and presets, see `docs/BLOG_VARIABLES_UI_SETUP.md`.

| Variable | Default | Purpose |
|----------|---------|---------|
| `BLOG_ENABLED` | `true` | Master kill switch — set to `false` to stop all blog generation |
| `BLOG_SOCIAL_BLUESKY` | `false` | Post link to Bluesky after PR is merged |
| `BLOG_SOCIAL_LINKEDIN` | `false` | Post link to LinkedIn after PR is merged |
| `BLOG_IMAGE_ENABLED` | `true` | Generate AI hero image (set `false` to skip and use logo) |
| `BLOG_CROSSPOST_GITHUB_PAGES` | `false` | Cross-post a Jekyll version to `rivie13/rivie13.github.io` |
| `BLOG_TEXT_PROVIDER` | `pollinations` | Preferred text provider: `pollinations` (Pollinations-first, GitHub fallback) |
| `BLOG_TEXT_MODEL_GITHUB` | `openai/gpt-5-chat` | GitHub Models text model ID |
| `BLOG_TEXT_MODEL_GITHUB_FALLBACK` | *(empty)* | Optional GitHub fallback model ID |
| `BLOG_TEXT_MODEL_POLLINATIONS` | `openai` | Pollinations text model alias |
| `BLOG_TEXT_MODEL_POLLINATIONS_FALLBACK` | `openai-fast` | Pollinations fallback model alias if primary fails |
| `BLOG_MAX_COMMITS` | `30` | Max commits sent to model in compact payload |
| `BLOG_MAX_MERGED_PRS` | `15` | Max merged PRs sent to model in compact payload |
| `BLOG_MAX_OPEN_PRS` | `20` | Max open PRs sent to model in compact payload |
| `BLOG_MAX_ISSUES` | `15` | Max issues sent to model in compact payload |

The workflow checks these at the top and exits early if disabled:

```yaml
jobs:
  generate:
    if: vars.BLOG_ENABLED == 'true'
```

### B4. Workflow steps

```
1. Check BLOG_ENABLED toggle → exit if false
2. Checkout Website Frontend (with PAT for push access)
3. Fetch Engine activity via GitHub API (last 24h):
   - GET /repos/rivie13/Phoenix-Agentic-Engine/commits?since=...
   - GET /repos/rivie13/Phoenix-Agentic-Engine/pulls?state=closed&sort=updated
   - GET /repos/rivie13/Phoenix-Agentic-Engine/issues?state=all&since=...
4. If zero activity → exit early (no post)
5. Generate blog post text (Pollinations-first, GitHub fallback)
  - System prompt loaded from `prompts/daily-blog-system.md`
  - Activity is prepared in three payload tiers: `full`, `limited`, `ultra`
  - Pollinations tries each tier first (`full` → `limited` → `ultra`) using primary model then fallback model
  - If Pollinations cannot produce content, GitHub Models runs the same tiered fallback sequence
  - If `BLOG_TEXT_PROVIDER=github`, order is reversed (GitHub first, Pollinations fallback)
  - Output: complete `.md` file with front matter
  - GitHub provider auth: workflow `GITHUB_TOKEN` with `permissions: models: read`
  - Pollinations provider auth: `POLLINATIONS_API_KEY`
6. If BLOG_IMAGE_ENABLED:
    - Validate `POLLINATIONS_API_KEY` and normalize either `sk_...` or `Bearer sk_...` formats
    - Validate key against `https://gen.pollinations.ai/account/key`
    - Attempt hero image via `https://gen.pollinations.ai/image/{encoded}` (`flux` then `turbo`)
    - Retries/backoff are used for transient upstream failures (5xx/52x/530)
    - If key is missing/invalid or model attempts fail → fall back to Phoenix logo
   - Phoenix logo also shown as persistent branding element on every post (below the header, separate from hero image)
7. Write .md file to content/blog/<date>-engine-daily-update.md
8. Commit changes to a new branch: blog/<date>-daily-update
9. Open a PR titled "blog: engine daily update — <date>"
   - PR body includes a preview of the post content
   - Assigned to repo owner for review
10. If BLOG_CROSSPOST_GITHUB_PAGES == true:
    - Convert front matter to Jekyll format
    - Push directly to rivie13/rivie13.github.io/_posts/phoenix/<date>-phoenix-engine-update.md
    - Direct push (no PR) — GitHub Pages deploys automatically
    - Jekyll post links back to phoenixengine.dev/blog/<slug> for full version + image
11. (Post-merge hook — separate workflow or job):
    - If BLOG_SOCIAL_BLUESKY == true → post link to Bluesky
    - If BLOG_SOCIAL_LINKEDIN == true → post link to LinkedIn
```

### B5. Social posting (separate workflow)

A second workflow `.github/workflows/blog-social.yml` triggers **on PR merge
to main** when the PR branch matches `blog/*`:

```yaml
on:
  pull_request:
    types: [closed]
    branches: [main]

jobs:
  post-social:
    if: >
      github.event.pull_request.merged == true &&
      startsWith(github.event.pull_request.head.ref, 'blog/')
```

This keeps social posting decoupled from generation. You merge the PR when
you're happy with the content, and only then does it post (if the toggles are
on).

### B6. Secrets needed

| Secret | Purpose |
|--------|---------|
| `GH_PAT` | **Optional for core blog generation.** Required only when `BLOG_CROSSPOST_GITHUB_PAGES=true` because cross-posting writes to `rivie13.github.io` (a second repo). |
| `POLLINATIONS_API_KEY` | **Required for Pollinations hero images.** Also required if `BLOG_TEXT_PROVIDER=pollinations`. Set from `enter.pollinations.ai` (raw `sk_...` preferred; `Bearer sk_...` also accepted and normalized). |
| `BLUESKY_HANDLE` + `BLUESKY_APP_PASSWORD` | Bluesky posting (only needed when toggle is on) |
| `LINKEDIN_ACCESS_TOKEN` | LinkedIn posting (only needed when toggle is on) |

> **Token safety rail:** The workflow now creates three payload tiers (`full`, `limited`, `ultra`) and automatically retries through them before giving up.

> **Provider order:** Default is Pollinations-first with GitHub fallback. You can reverse it by setting `BLOG_TEXT_PROVIDER=github`.

> **No `OPENAI_API_KEY` needed.** Text generation uses either `GITHUB_TOKEN` (GitHub Models) or Pollinations key auth. Image generation always uses Pollinations `gen.pollinations.ai` with `POLLINATIONS_API_KEY`.

All secrets are configured in GitHub repo settings. Social secrets are only
required when you enable those toggles.

---

## Part C — AI Prompt Template

File: `prompts/daily-blog-system.md` (version-controlled, editable)

The prompt enforces:

- Proper YAML front matter with `aiGenerated: true`
- A one-sentence `summary` field for the blog index card
- A disclaimer paragraph at the top of the post body
- Links back to actual PRs / commits / issues on GitHub
- Consistent structure:
  1. Summary
  2. What Changed
  3. PRs Merged (with links)
  4. Issues Updated (with links)
  5. What's Next / Looking Ahead
- Professional but approachable tone
- No speculation about private/backend internals

A separate image prompt template generates the DALL-E prompt:

> "Create a stylized, abstract digital art piece representing game engine
> development. Theme: [derived from post content]. Style: dark background,
> orange (#f97316) accent color, futuristic/phoenix motif. No text in the
> image."

---

## Part D — Safety & Quality Rails

| Concern | Mitigation |
|---------|-----------|
| Bad AI output | **PR-based review** — nothing merges without human approval (Phoenix website) |
| Empty days | Workflow skips if no Engine activity detected |
| Duplicate posts | Filename is date-stamped; workflow checks if branch/file already exists |
| Image generation failure | Graceful fallback to Phoenix logo as hero image |
| Cost | Configurable — use GitHub provider for text + Pollinations for image (lowest pollen usage), or Pollinations for both text+image if preferred |
| Private info leak | Only Engine repo (public) is scanned; Backend is excluded |
| Social post timing | Social posts only fire after PR merge, not on generation |
| Accidental social spam | Both social toggles default to `false` |
| Human posts | Same `content/blog/` dir, `aiGenerated: false`, no badge, no disclaimer |
| Stale builds | PR merge triggers existing CI → `next build` runs automatically |
| GitHub Pages cross-post review | Cross-post is a direct push (no PR). Since it links back to Phoenix website and you still review the Phoenix PR, this is acceptable. Toggle is `false` by default. |
| GitHub Pages duplicate | Checks if `_posts/phoenix/<date>-phoenix-engine-update.md` already exists before pushing |

---

## Part E — Future Enhancements (Not MVP)

- [ ] RSS / Atom feed auto-generated from `content/blog/`
- [ ] Weekly digest post (rolls up the week's daily posts)
- [ ] Interface repo coverage (public parts only)
- [ ] OG image generation (social preview cards)
- [ ] Comment system (GitHub Discussions-backed or similar)
- [ ] Post categories / filtering on the blog index
- [ ] Multi-repo activity in a single post

---

## Implementation Order

| Step | What | Effort |
|------|------|--------|
| 1 | Create `content/blog/` dir + sample post | 10 min |
| 2 | Install `gray-matter` + `remark` + `remark-html` | 5 min |
| 3 | Build `src/lib/blog.ts` data layer | 30 min |
| 4 | Refactor `/blog` index page | 30 min |
| 5 | Create `/blog/[slug]` detail page | 30 min |
| 6 | Add AI badge + disclaimer styling | 15 min |
| 7 | Create `prompts/daily-blog-system.md` | 20 min |
| 8 | Create `.github/workflows/daily-blog.yml` | 45 min |
| 9 | Create `.github/workflows/blog-social.yml` | 30 min |
| 10 | Add repo variables + secrets in GitHub UI | 10 min |
| 11 | Test with `workflow_dispatch` | 15 min |
| **Total** | | **~4 hours** |

All implementation is in the **Website Frontend repo**. The Engine repo
requires **zero changes**.

---

## Configuration Quick Reference

### Turn blog generation on/off

GitHub → `rivie13/Phoenix-Agentic-Website-Frontend` → Settings → Variables →
Actions → Set `BLOG_ENABLED` to `true` or `false`.

### Turn social posting on/off

Same location:
- `BLOG_SOCIAL_BLUESKY` → `true` / `false`
- `BLOG_SOCIAL_LINKEDIN` → `true` / `false`

### Turn image generation on/off

- `BLOG_IMAGE_ENABLED` → `true` / `false`

### Choose text provider and model

- `BLOG_TEXT_PROVIDER` → `pollinations` (recommended) or `github`
- If `github`: set `BLOG_TEXT_MODEL_GITHUB` (default `openai/gpt-5-chat`)
- Optional GitHub model fallback: `BLOG_TEXT_MODEL_GITHUB_FALLBACK`
- If `pollinations`: set `BLOG_TEXT_MODEL_POLLINATIONS` (for example `openai`, `openai-fast`, `claude-fast`) and optional `BLOG_TEXT_MODEL_POLLINATIONS_FALLBACK`

### Tune token budget

- `BLOG_MAX_COMMITS`, `BLOG_MAX_MERGED_PRS`, `BLOG_MAX_OPEN_PRS`, `BLOG_MAX_ISSUES`
- Lower values reduce prompt size/pollen usage and improve reliability for constrained model contexts

### Turn GitHub Pages cross-posting on/off

- `BLOG_CROSSPOST_GITHUB_PAGES` → `true` / `false`
- When enabled, posts go to `rivie13/rivie13.github.io/_posts/phoenix/` automatically (no PR — direct push, GitHub Pages deploys on its own)
- The Jekyll post includes a callout linking back to the full Phoenix website version
